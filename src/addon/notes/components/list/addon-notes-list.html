<core-navbar-buttons end>
     <ion-button [hidden]="!canDeleteNotes" slot="end" slot="icon-only //TODO: mode to icon" fill="clear" (click)="toggleDelete($event)" [attr.aria-label]="'core.delete' | translate">
        <ion-icon name="create" ios="md-create"></ion-icon>
    </ion-button>
    <core-context-menu>
        <core-context-menu-item [hidden]="!(notesLoaded && !hasOffline)" [priority]="100" [content]="'core.refresh' | translate" (action)="refreshNotes(false)" [iconAction]="refreshIcon" [closeOnClick]="true"></core-context-menu-item>
        <core-context-menu-item [hidden]="!(notesLoaded && hasOffline)" [priority]="100" [content]="'core.settings.synchronizenow' | translate" (action)="refreshNotes(true)" [iconAction]="syncIcon" [closeOnClick]="false"></core-context-menu-item>
    </core-context-menu>
</core-navbar-buttons>

<ion-content>
    <ion-refresher [enabled]="notesLoaded" (ionRefresh)="refreshNotes(false, $event)">
        <ion-refresher-content pullingText="{{ 'core.pulltorefresh' | translate }}"></ion-refresher-content>
    </ion-refresher>
    <core-loading [hideUntil]="notesLoaded" class="core-loading-center">
        <ion-item class="ion-text-wrap" *ngIf="user">
            <ion-avatar core-user-avatar [user]="user" [courseId]="courseId" slot=”start” [linkProfile]="false"></ion-avatar>
            <h2>{{user.fullname}}</h2>
        </ion-item>

        <div class="ion-padding">
            <ion-select [(ngModel)]="type" (ngModelChange)="typeChanged()" interface="popover" class="core-button-select">
                <ion-select-option value="site">{{ 'addon.notes.sitenotes' | translate }}</ion-select-option>
                <ion-select-option value="course">{{ 'addon.notes.coursenotes' | translate }}</ion-select-option>
                <ion-select-option value="personal">{{ 'addon.notes.personalnotes' | translate }}</ion-select-option>
            </ion-select>
        </div>

        <div class="core-warning-card" slot="start //TODO: mode to icon" *ngIf="hasOffline">
            <ion-icon name="warning"></ion-icon>
            {{ 'core.thereisdatatosync' | translate:{$a: 'addon.notes.notes' | translate | lowercase } }}
        </div>

        <core-empty-box *ngIf="notes && notes.length == 0" icon="list" [message]="'addon.notes.nonotes' | translate"></core-empty-box>

        <ion-list *ngIf="notes && notes.length > 0">
            <ion-card *ngFor="let note of notes">
                <ion-item class="ion-text-wrap">
                    <ion-avatar core-user-avatar [user]="note" [courseId]="courseId" slot=”start” *ngIf="!userId"></ion-avatar>
                    <h2 *ngIf="!userId">{{note.userfullname}}</h2>
                    <p *ngIf="!note.deleted && !note.offline" slot="end">
                        <span class="ion-text-wrap">{{note.lastmodified | coreDateDayOrTime}}</span>
                    </p>
                    <p *ngIf="note.offline" slot="end">
                        <ion-icon name="time"></ion-icon> <span class="ion-text-wrap">{{ 'core.notsent' | translate }}</span></p>
                    <p *ngIf="note.deleted" slot="end">
                        <ion-icon name="trash"></ion-icon> <span class="ion-text-wrap">{{ 'core.deletedoffline' | translate }}</span>
                    </p>
                    <ion-button *ngIf="note.deleted" slot="end" slot="icon-only //TODO: mode to icon" fill="clear" color="danger" (click)="undoDeleteNote($event, note)" [attr.aria-label]="'core.restore' | translate">
                        <ion-icon name="undo"></ion-icon>
                    </ion-button>
                    <ion-button *ngIf="showDelete && !note.deleted && (type != 'personal' || note.usermodified == currentUserId)" slot="end" slot="icon-only //TODO: mode to icon" fill="clear" [@coreSlideInOut]="'fromRight'" color="danger" (click)="deleteNote($event, note)" [attr.aria-label]="'core.delete' | translate">
                        <ion-icon name="trash"></ion-icon>
                    </ion-button>
                </ion-item>
                <ion-item class="ion-text-wrap"><core-format-text [text]="note.content" [filter]="false"></core-format-text></ion-item>
            </ion-card>
        </ion-list>

    </core-loading>
    <ion-fab slot="fixed" core-fab vertical="bottom" horizontal="end" *ngIf="userId && notesLoaded">
        <ion-fab-button (click)="addNote($event)" [attr.aria-label]="'addon.notes.addnewnote' |translate">
            <ion-icon name="add"></ion-icon>
        </ion-fab-button>
    </ion-fab>
</ion-content>
