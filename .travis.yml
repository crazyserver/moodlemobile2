sudo: required
dist: trusty
group: edge

addons:
  apt:
    sources:
      - google-chrome
    packages:
      - google-chrome-stable
      - screen
  sauce_connect: true

language: node_js
node_js:
  - '8.10'

before_script:
  - npm install -g @angular/cli
  - npm i npm@latest protractor -g
  # - npm i -g webdriver-manager
  # - webdriver-manager update
  # - screen webdriver-manager start
  - gulp
  - rm -Rf node_modules/electron-builder-squirrel-windows node_modules/electron-windows-notifications #Avoid electron fail
  - screen -dm ionic serve -b -a -d --nogulp --address localhost --port 8100 # We use screen here because nohup does not work with ionic serve.
  - sleep 15  # Wait a lot here, selenium and gulp:before task and ionic must be running.

matrix:
  fast_finish: false

  include:
    - script:
      - npm run tsc e2e/sauce/browser/protractor-sauce-browser-login.ts
      - ./node_modules/protractor/bin/protractor e2e/sauce/browser/protractor-sauce-browser-login.js