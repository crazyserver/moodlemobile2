language: node_js
node_js: 12
cache: npm

android:
    components:
    - tools
    - platform-tools
    - build-tools-29.0.3
    - android-28
    - extra-google-google_play_services
    - extra-google-m2repository
    - extra-android-m2repository

jobs:
  include:
  - stage: check
    script:
      - npm run lint
      - npm run test:ci
      - npm run build:prod
  - stage: mirror
    if: branch IN (master, integration, ionic5) AND repo = moodlehq/moodleapp AND type != cron
    script:
      - scripts/mirror.sh
  - stage: build
    name: "Build Android"
    if: env(DEPLOY) IS present AND (env(DEPLOY) = 1 AND type != cron
    dist: trusty
    language: android
    env:
    - BUILD_PLATFORM='android'
    before_install:
    - nvm install 12
    - node --version
    - npm --version
    - nvm --version
    - npm ci
    - npm install -g gulp
    script: scripts/aot.sh
